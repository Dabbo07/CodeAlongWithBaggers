#program testgame  10 GO SUB 100: REM saveGameState  20 RUN AT 3  30 GO SUB 1000: REM loadSetup  40 GO SUB 2000: REM menu  45 GO SUB 3500: REM gameSetup  50 GO SUB 3000: REM levelSetup  60 GO SUB 4000: REM gameLoop  61 IF levcomp=1 THEN GO SUB 900: GO TO 50  62 IF died=1 THEN GO SUB 800  69 IF gameover=0 THEN GO TO 50  70 GO SUB 5000: REM gameOver  80 GO TO 40 100 REM saveGameState 110 SPRITE CLEAR : LAYER 2,0: LAYER 0: PAPER 0: BORDER 0: INK 6: CLS  120 PRINT "Saving: testgame.bas" 130 SAVE "testgame.bas" 140 PRINT "Saving: testgame.txt" 150 .bas2txt testgame.bas 160 PRINT "Save complete." 170 RETURN  800 REM died 810 LET lives=lives-1 815 SPRITE CLEAR  820 IF lives =0 THEN LET gameover=1 830 RETURN  900 REM levelComplete 910 LET %l=%l+1 920 IF %l=4 THEN LET %l=0: RETURN  930 RETURN 1000 REM loadSetup1010 LAYER 2,0: SPRITE CLEAR : CLS 1020 LET tempbank=141030 LET tilemapbank=15: LET %b=tilemapbank1040 LOAD "img/tiles.spr" BANK tempbank1050 SPRITE BANK tempbank1060 LOAD "img/block.spr" BANK tempbank1070 TILE BANK tempbank1075 LOAD "img/levels.spr" BANK tilemapbank1076 LET wallObj=1: LET gemObj=5: LET exitObj=3: LET ladderObj=21077 LET maxenemies=201078 DIM e(maxenemies,5): LET badanim=01079 RETURN 1080 REM resetLevel1081 LET numbad=0: LET bx=0: LET by=01082 LET ptr=81921090 FOR %i=0 TO 191 1100 LET %v=% BANK b PEEK (l*256+i)1110 LET %u=01120 IF %v=$F5 THEN LET %u=gemObj 1121 IF %v=$01 THEN LET %u=wallObj1122 IF %v=$1D THEN LET %u=exitObj1123 IF %v=$1C THEN LET numbad=numbad+1: LET e(numbad,1)=bx+32+8: LET e(numbad,2)=by+32+14: LET e(numbad,3)=1.0: LET e(numbad,4)=0.0: LET e(numbad,5)=81124 IF %v=$E0 THEN LET numbad=numbad+1: LET e(numbad,1)=bx+32+8: LET e(numbad,2)=by+32+14: LET e(numbad,3)=0.0: LET e(numbad,4)=1.0: LET e(numbad,5)=41125 LET bx=bx+16: IF bx>=256 THEN LET bx=0: LET by=by+161170 BANK tilemapbank POKE ptr,%u1180 LET ptr=ptr+11190 NEXT %i1200 TILE DIM tilemapbank,8192,16,161210 LET died=0: LET levcomp=01990 RETURN 2000 REM menu2010 PAPER 0: BORDER 0: INK 7: LAYER 2,0: LAYER 0: CLS 2020 PRINT AT 11,5;"Press a key to start"2030 PAUSE 02990 RETURN 3000 REM levelSetup3010 SPRITE CLEAR : CLS : INK 6: PRINT AT 12,12;"GET READY!": LAYER 2,0: GO SUB 1080: TILE AT 0,0: LAYER 2,13015 GO SUB 72003020 LET px=32+16+83030 LET py=32+192-32+83040 LET pp=03050 LET pf=13060 SPRITE PRINT 13070 GO SUB 10803490 RETURN 3500 REM gameSetup3510 LET %l=0 3520 LET died=03530 LET lives=33540 LET sc=03550 LET levcomp=03560 LET gameover=03990 RETURN 4000 REM game4020 GO SUB 6000: REM handlePlayer4030 GO SUB 8000: REM handleEnemies4040 IF levcomp=1 THEN RETURN 4050 IF died=1 THEN RETURN 4990 GO TO 40005000 REM game over5010 SPRITE PRINT 05020 LAYER 2,0: LAYER 0: CLS 5030 PRINT AT 1,1;"Game over!"5040 PAUSE 05990 RETURN 6000 REM handlePlayer6010 SPRITE 0,px-8,py-14,pp,pf6020 LET ox=px: LET oy=py: LET pa=0: LET dx=0: LET dy=06030 IF %( IN $fbfe & 1)=0 THEN LET py=py-1: LET pa=1: LET dy=-16040 IF %( IN $fdfe & 1)=0 THEN LET py=py+1: LET pa=1: LET dy=16050 IF %( IN $dffe & 2)=0 THEN LET px=px-1: LET pa=1: LET dx=-16060 IF %( IN $dffe & 1)=0 THEN LET px=px+1: LET pa=1: LET dx=16065 IF %( IN $fdfe & 4)=0 THEN LET died=16070 LET tx=px: LET ty=py: GO SUB 70006080 IF pa=1 THEN LET pp=pp+1: IF pp=2 THEN LET pp=06090 IF %r= INT {wallObj} THEN LET px=ox: LET py=oy: LET pp=0 6100 IF %r= INT {exitObj} THEN LET levcomp=1 6110 IF %r= INT {gemObj} THEN LET sc=sc+100: GO SUB 71006990 RETURN 7000 REM collisionDetection7010 LET %x= INT ((tx-32)/16): LET %y= INT ((ty-32)/16)7020 LET %r=% BANK b PEEK (8192+(y*16)+x)7030 RETURN 7100 REM tileRemove7110 LET %x= INT ((tx-32)/16): LET %y= INT ((ty-32)/16) 7120 BANK %b POKE %(8192+(y*16)+x),0 7130 TILE AT 0,0: GO SUB 72007140 RETURN 7200 REM displayScores7205 PAPER 1: INK 137210 PRINT AT 0,0;"SC:";sc7220 PRINT AT 0,12;"LEV:";%l+17230 PRINT AT 0,25;"LIVES:";lives7240 RETURN 8000 REM handleEnemies8010 IF numbad=0 THEN RETURN 8020 FOR n=1 TO numbad8030 LET e(n,1)=e(n,1)+e(n,3): LET e(n,2)=e(n,2)+e(n,4)8040 LET tx=e(n,1): LET ty=e(n,2): GO SUB 70008050 IF %r= INT {wallObj} THEN LET e(n,1)=e(n,1)-e(n,3): LET e(n,3)=-e(n,3): LET e(n,2)=e(n,2)-e(n,4): LET e(n,4)=-e(n,4)8060 IF ((e(n,1)+16)>px) THEN IF ((px+16)>e(n,1)) THEN IF ((e(n,2)+16)>py) THEN IF ((py+16)>e(n,2)) THEN LET died=18070 SPRITE n,e(n,1)-8,e(n,2)-14,e(n,5)+badanim,18080 NEXT n8085 LET badanim=badanim+1: IF badanim=4 THEN badanim=08090 RETURN 